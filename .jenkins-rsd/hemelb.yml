# default build across compilers and machines
- job-template:
    name: '{name}-heme'
    description: |
        Compiles, runs units tests, and runs regressions for several types of
        builds.

        Since steering does not have unittests and since it prevents running
        multiple instances of heme on the same node (because port is hard
        coded), steering build is not unittested.
    disabled: false
    block-upstream: true
    builders:
        - heme-remove-build
        - heme-flags
        # build dependencies
        - heme-dependencies
        # build with/without streak-lines, with/whithout sse3
        - heme-Code:
            buildname: 'streaks:{streaks}_steering:{steering}_sse3:{sse3}'
            sse3: '{sse3}'
            streaks: '{streaks}'
            steering: '{steering}'

        - heme-test:
            buildname: 'streaks:{streaks}_steering:{steering}_sse3:{sse3}'

        - heme-regression-setup
        - heme-regression-run:
            buildname: 'streaks:{streaks}_steering:{steering}_sse3:{sse3}'

    triggers:
        - '{trigger}'

    publishers:
        - cpp_unit_tests

- project:
    name: 'steering_and_streaks'
    steering: 'basic'
    streaks: 'ON'
    sse3: 'OFF'
    trigger: 'nightly_and_hook'
    branch: origin/master
    refspec: +refs/heads/*:refs/remotes/origin/*
    jobs:
        - '{name}-heme'

- project:
    name: 'development'
    steering: 'none'
    streaks: 'OFF'
    sse3: 'ON'
    trigger: 'nightly_and_hook'
    branch: origin/master
    refspec: +refs/heads/*:refs/remotes/origin/*
    jobs:
        - '{name}-heme'

- project:
    name: 'pull-request'
    steering: 'none'
    streaks: 'OFF'
    sse3: 'ON'
    trigger: 'pull_request_trigger'
    branch: $sha1
    refspec: +refs/heads/*:refs/remotes/origin/*
    jobs:
        - '{name}-heme'
